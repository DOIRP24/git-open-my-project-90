
!function(){"use strict";const e={baseUrl:"https://sns-welcome.vercel.app",containerId:"sns-welcome-widget",background:"#111827"};function t(){const t=`.sns-welcome-widget-container{width:100%;height:100vh;margin:0;padding:0;background:${e.background};overflow:hidden;position:relative;min-height:100vh}.sns-welcome-widget-content{width:100%;height:100%;min-height:100vh;background:${e.background};display:block;position:relative;z-index:1;overflow-y:auto;-webkit-overflow-scrolling:touch}.sns-welcome-widget-loading{position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);color:#02a374;font-family:Arial,sans-serif;font-size:16px;z-index:10;text-align:center}.sns-welcome-widget-spinner{border:2px solid #374151;border-top:2px solid #02a374;border-radius:50%;width:30px;height:30px;animation:sns-widget-spin 1s linear infinite;margin:0 auto 10px}@keyframes sns-widget-spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}body.sns-widget-fullscreen{margin:0!important;padding:0!important;overflow:hidden!important;height:100vh!important;max-height:100vh!important}body.sns-widget-fullscreen .sns-welcome-widget-container{position:fixed!important;top:0!important;left:0!important;right:0!important;bottom:0!important;z-index:2147483647!important;width:100vw!important;height:100vh!important;max-width:100vw!important;max-height:100vh!important}body.sns-widget-fullscreen .sns-welcome-widget-content{width:100vw!important;height:100vh!important;max-width:100vw!important;max-height:100vh!important;min-height:100vh!important}body.sns-widget-fullscreen>*:not(.sns-welcome-widget-container){display:none!important}.sns-welcome-widget-content *{box-sizing:border-box}@media screen and (max-width: 768px){.sns-welcome-widget-container{height:100vh!important;min-height:100vh!important;max-height:100vh!important}.sns-welcome-widget-content{height:100vh!important;min-height:100vh!important;max-height:100vh!important}body.sns-widget-fullscreen{position:fixed!important;width:100%!important;height:100%!important}}@supports (-webkit-touch-callout: none){.sns-welcome-widget-content{-webkit-overflow-scrolling:touch;overflow-y:scroll}}html.sns-widget-active,html.sns-widget-active body{height:100%!important;max-height:none!important;overflow:hidden!important}`,n=document.createElement("style");n.textContent=t,document.head.appendChild(n)}function n(){return`<div class="sns-welcome-widget-container"><div class="sns-welcome-widget-loading"><div class="sns-welcome-widget-spinner"></div><div>Загрузка Welcome курса...</div></div><div class="sns-welcome-widget-content" id="sns-widget-content"></div></div>`}async function i(t){const n=t.querySelector(".sns-welcome-widget-loading"),i=t.querySelector(".sns-welcome-widget-content");try{console.log("Попытка загрузки контента без iframe...");const t=await fetch(e.baseUrl,{method:"GET",headers:{Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","User-Agent":"SNSWelcomeWidget/1.0"},mode:"cors",credentials:"omit"});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const o=await t.text();console.log("Контент загружен успешно");const a=new DOMParser,l=a.parseFromString(o,"text/html").body;if(l){i.innerHTML=l.innerHTML;const e=i.querySelectorAll("script");e.forEach(((e,t)=>{try{const n=document.createElement("script");e.src?(n.src=e.src,n.async=!0):e.textContent&&(n.textContent=e.textContent),document.head.appendChild(n),console.log(`Скрипт ${t+1} добавлен`)}catch(e){console.warn(`Ошибка при добавлении скрипта ${t+1}:`,e)}}));const t=l.querySelectorAll("style, link[rel=\"stylesheet\"]");t.forEach(((e,t)=>{try{"STYLE"===e.tagName?(newStyle=document.createElement("style"),newStyle.textContent=e.textContent,document.head.appendChild(newStyle)):"LINK"===e.tagName&&(newLink=document.createElement("link"),newLink.rel="stylesheet",newLink.href=e.href,document.head.appendChild(newLink)),console.log(`Стиль ${t+1} добавлен`)}catch(e){console.warn(`Ошибка при добавлении стиля ${t+1}:`,e)}}))}n&&(n.style.display="none"),console.log("SNS Welcome Widget (без iframe) успешно загружен")}catch(t){console.error("Ошибка загрузки контента без iframe:",t),console.log("Переключение на fallback с iframe..."),i.innerHTML=`<iframe src="${e.baseUrl}" style="width: 100%; height: 100%; border: none; background: ${e.background};" title="SNS Welcome Course" allowfullscreen allow="accelerometer; autoplay; camera; clipboard-read; clipboard-write; encrypted-media; fullscreen; geolocation; gyroscope; magnetometer; microphone; midi; payment; picture-in-picture; publickey-credentials-get; screen-wake-lock; web-share; xr-spatial-tracking" sandbox="allow-forms allow-modals allow-orientation-lock allow-pointer-lock allow-popups allow-popups-to-escape-sandbox allow-presentation allow-same-origin allow-scripts allow-top-navigation allow-top-navigation-by-user-activation" loading="eager" referrerpolicy="strict-origin-when-cross-origin"></iframe>`;const o=i.querySelector("iframe");o&&(o.addEventListener("load",(function(){console.log("Fallback iframe загружен успешно")})),o.addEventListener("error",(function(){console.error("Ошибка загрузки fallback iframe")}))),n&&(n.style.display="none"),console.log("Использован fallback с iframe")}}function o(){document.documentElement.classList.add("sns-widget-active"),document.body.classList.add("sns-widget-fullscreen");const e=document.body.style.overflow,t=document.documentElement.style.overflow;document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden",window.SNSWelcomeWidget._originalOverflow=e,window.SNSWelcomeWidget._originalHtmlOverflow=t;let n=document.querySelector('meta[name="viewport"]');n||(n=document.createElement("meta"),n.name="viewport",document.head.appendChild(n)),window.SNSWelcomeWidget._originalViewport=n.content,n.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"}function a(){const a=document.getElementById(e.containerId);if(!a)return void console.error(`SNS Widget: Контейнер с ID "${e.containerId}" не найден`);t(),o(),a.innerHTML=n(),i(a),a.addEventListener("click",(function(e){e.stopPropagation()})),console.log("SNS Welcome Widget (без iframe) инициализирован")}function l(){document.documentElement.classList.remove("sns-widget-active"),document.body.classList.remove("sns-widget-fullscreen"),void 0!==window.SNSWelcomeWidget._originalOverflow&&(document.body.style.overflow=window.SNSWelcomeWidget._originalOverflow),void 0!==window.SNSWelcomeWidget._originalHtmlOverflow&&(document.documentElement.style.overflow=window.SNSWelcomeWidget._originalHtmlOverflow);if(void 0!==window.SNSWelcomeWidget._originalViewport){const e=document.querySelector('meta[name="viewport"]');e&&(e.content=window.SNSWelcomeWidget._originalViewport)}const t=document.getElementById(e.containerId);t&&(t.innerHTML=""),console.log("SNS Welcome Widget закрыт")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",a):a(),window.SNSWelcomeWidget={init:a,destroy:l,config:e}}();
