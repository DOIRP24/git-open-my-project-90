
!function(){"use strict";const e={baseUrl:"https://sns-welcome.vercel.app",containerId:"sns-welcome-widget",background:"#111827",mobileBreakpoint:768,loadingTimeout:15e3};function t(){const t=`.sns-welcome-widget-container{position:fixed!important;top:0!important;left:0!important;width:100vw!important;height:100vh!important;height:100dvh!important;margin:0!important;padding:0!important;background:${e.background}!important;overflow:hidden!important;z-index:2147483647!important;display:flex!important;flex-direction:column!important;box-sizing:border-box!important}.sns-welcome-widget-content{flex:1!important;width:100%!important;height:100%!important;background:${e.background}!important;display:block!important;position:relative!important;overflow-y:auto!important;overflow-x:hidden!important;-webkit-overflow-scrolling:touch!important;box-sizing:border-box!important}.sns-welcome-widget-loading{position:absolute!important;top:50%!important;left:50%!important;transform:translate(-50%,-50%)!important;color:#02a374!important;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',system-ui,sans-serif!important;font-size:16px!important;z-index:10!important;text-align:center!important;background:${e.background}!important;padding:20px!important;border-radius:8px!important}.sns-welcome-widget-spinner{border:2px solid #374151!important;border-top:2px solid #02a374!important;border-radius:50%!important;width:30px!important;height:30px!important;animation:sns-widget-spin 1s linear infinite!important;margin:0 auto 10px!important}@keyframes sns-widget-spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}body.sns-widget-active>*:not(.sns-welcome-widget-container){display:none!important;visibility:hidden!important}body.sns-widget-active{margin:0!important;padding:0!important;overflow:hidden!important;height:100vh!important;height:100dvh!important;max-height:100vh!important;max-height:100dvh!important;position:fixed!important;width:100%!important;top:0!important;left:0!important}html.sns-widget-active{height:100%!important;height:100dvh!important;max-height:none!important;overflow:hidden!important;position:fixed!important;width:100%!important}.sns-welcome-widget-content *{box-sizing:border-box!important}.sns-welcome-widget-content img{max-width:100%!important;height:auto!important}.sns-welcome-widget-content iframe{width:100%!important;height:100%!important;border:none!important;background:${e.background}!important}@supports (-webkit-touch-callout:none){.sns-welcome-widget-container{height:100vh!important;height:-webkit-fill-available!important}.sns-welcome-widget-content{height:100%!important;height:-webkit-fill-available!important;-webkit-overflow-scrolling:touch!important;overflow-y:scroll!important}body.sns-widget-active{height:100vh!important;height:-webkit-fill-available!important}html.sns-widget-active{height:100vh!important;height:-webkit-fill-available!important}}@media screen and (max-width:${e.mobileBreakpoint}px){.sns-welcome-widget-container{position:fixed!important;inset:0!important;width:100vw!important;height:100vh!important;height:100dvh!important}.sns-welcome-widget-content{width:100%!important;height:100%!important;min-height:100vh!important;min-height:100dvh!important}body.sns-widget-active{position:fixed!important;inset:0!important;width:100%!important;height:100%!important}}.sns-welcome-widget-content::-webkit-scrollbar{width:0!important;background:transparent!important}.sns-welcome-widget-container.loading{opacity:0;transition:opacity .3s ease}.sns-welcome-widget-container.loaded{opacity:1}`,n=document.createElement("style");n.textContent=t,n.id="sns-widget-styles",document.head.appendChild(n)}function n(){return'<div class="sns-welcome-widget-container loading"><div class="sns-welcome-widget-loading"><div class="sns-welcome-widget-spinner"></div><div>Загрузка Welcome курса...</div></div><div class="sns-welcome-widget-content" id="sns-widget-content"></div></div>'}function i(){let t=document.querySelector('meta[name=viewport]');t||(t=document.createElement("meta"),t.name="viewport",document.head.appendChild(t)),window.SNSWelcomeWidget._originalViewport=t.content,t.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover, interactive-widget=resizes-content"}function o(){document.documentElement.classList.add("sns-widget-active"),document.body.classList.add("sns-widget-active");const e=document.body.style.overflow,t=document.documentElement.style.overflow,n=document.body.style.position;document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden",document.body.style.position="fixed",document.body.style.width="100%",document.body.style.height="100%",document.body.style.top="0",document.body.style.left="0",window.SNSWelcomeWidget._originalStyles={bodyOverflow:e,htmlOverflow:t,bodyPosition:n},i()}async function a(t){const n=t.querySelector(".sns-welcome-widget-loading"),i=t.querySelector(".sns-welcome-widget-content"),o=t.querySelector(".sns-welcome-widget-container");function d(){n&&(n.style.display="none"),o&&(o.classList.remove("loading"),o.classList.add("loaded")),console.log("Загрузка завершена")}console.log("Начинаем загрузку контента для мобильных устройств...");try{n&&(n.style.display="block");const t=await fetch(e.baseUrl,{method:"GET",headers:{Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","User-Agent":"SNSWelcomeWidget/2.0 Mobile","Cache-Control":"no-cache"},mode:"cors",credentials:"omit"});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const o=await t.text();console.log("HTML контент получен, размер:",o.length);const a=l(o);if(a)i.innerHTML=a,console.log("Контент успешно вставлен в DOM"),await s(i),c(o);else throw new Error("Не удалось обработать контент")}catch(t){console.error("Ошибка загрузки контента:",t),console.log("Переключаемся на iframe fallback..."),i.innerHTML=`\n                <iframe \n                    src="${e.baseUrl}"\n                    style="width: 100%; height: 100%; border: none; background: ${e.background}; display: block;"\n                    title="SNS Welcome Course"\n                    allowfullscreen\n                    allow="accelerometer; autoplay; camera; clipboard-read; clipboard-write; encrypted-media; fullscreen; geolocation; gyroscope; magnetometer; microphone; midi; payment; picture-in-picture; publickey-credentials-get; screen-wake-lock; web-share; xr-spatial-tracking"\n                    sandbox="allow-forms allow-modals allow-orientation-lock allow-pointer-lock allow-popups allow-popups-to-escape-sandbox allow-presentation allow-same-origin allow-scripts allow-top-navigation allow-top-navigation-by-user-activation"\n                    loading="eager"\n                    referrerpolicy="strict-origin-when-cross-origin">\n                </iframe>\n            `;const n=i.querySelector("iframe");n&&(n.onload=()=>{console.log("Iframe загружен успешно"),d()},n.onerror=()=>{console.error("Ошибка загрузки iframe"),d()})}setTimeout(d,e.loadingTimeout),i.innerHTML.trim()&&setTimeout(d,1e3)}function l(e){try{const t=new DOMParser,n=t.parseFromString(e,"text/html").body;if(!n)throw new Error("Не найден body в HTML");n.querySelectorAll('script[src*="analytics"], script[src*="gtag"], script[src*="facebook"], noscript, .hidden-mobile').forEach((e=>e.remove()));return n.querySelectorAll("img").forEach((e=>{e.style.maxWidth="100%",e.style.height="auto",e.loading="lazy"})),n.innerHTML}catch(e){return console.error("Ошибка обработки контента:",e),null}}async function s(e){const t=e.querySelectorAll("script");console.log("Найдено скриптов:",t.length);for(let e=0;e<t.length;e++){const n=t[e];try{const t=document.createElement("script");if(n.src)t.src=n.src,t.async=!0,t.defer=!0;else{if(!n.textContent||!n.textContent.trim())continue;t.textContent=n.textContent}document.head.appendChild(t),console.log(`Скрипт ${e+1} добавлен`),await new Promise((e=>setTimeout(e,100)))}catch(t){console.warn(`Ошибка при обработке скрипта ${e+1}:`,t)}}}function c(e){try{const t=new DOMParser,n=t.parseFromString(e,"text/html");n.querySelectorAll("style").forEach(((e,t)=>{if(e.textContent&&e.textContent.trim()){const n=document.createElement("style");n.textContent=e.textContent,n.id=`sns-widget-style-${t}`,document.head.appendChild(n),console.log(`Стиль ${t+1} добавлен`)}})),n.querySelectorAll('link[rel="stylesheet"]').forEach(((e,t)=>{if(e.href){const n=document.createElement("link");n.rel="stylesheet",n.href=e.href,n.id=`sns-widget-link-${t}`,document.head.appendChild(n),console.log(`Внешний стиль ${t+1} добавлен`)}}))}catch(e){console.warn("Ошибка при обработке стилей:",e)}}class r{constructor(){this.initialized=!1,this.container=null}async init(){if(this.initialized)return void console.log("Виджет уже инициализирован");console.log("Инициализация мобильного виджета..."),this.container=document.getElementById(e.containerId),this.container?((()=>{try{t(),o(),this.container.innerHTML=n(),a(this.container),this.setupEventListeners(),this.initialized=!0,console.log("Мобильный виджет успешно инициализирован")}catch(e){console.error("Ошибка инициализации виджета:",e)}})(),,this.initialized=!0,console.log("Мобильный виджет успешно инициализирован")):console.error(`Контейнер с ID "${e.containerId}" не найден`)}setupEventListeners(){this.container&&this.container.addEventListener("click",(e=>{e.stopPropagation()})),window.addEventListener("orientationchange",(()=>{setTimeout((()=>{this.adjustForOrientation()}),100)})),window.addEventListener("resize",(()=>{this.adjustForOrientation()}))}adjustForOrientation(){if(!this.container)return;const e=this.container.querySelector(".sns-welcome-widget-container"),t=this.container.querySelector(".sns-welcome-widget-content");e&&t&&(e.style.height="100vh",e.style.height="100dvh",t.style.height="100%",console.log("Виджет адаптирован под новую ориентацию"))}destroy(){this.initialized&&(console.log("Закрытие мобильного виджета..."),document.documentElement.classList.remove("sns-widget-active"),document.body.classList.remove("sns-widget-active"),window.SNSWelcomeWidget._originalStyles&&(document.body.style.overflow=window.SNSWelcomeWidget._originalStyles.bodyOverflow||"",document.documentElement.style.overflow=window.SNSWelcomeWidget._originalStyles.htmlOverflow||"",document.body.style.position=window.SNSWelcomeWidget._originalStyles.bodyPosition||"",document.body.style.width="",document.body.style.height="",document.body.style.top="",document.body.style.left=""),window.SNSWelcomeWidget._originalViewport&&(document.querySelector('meta[name="viewport"]')?.content=window.SNSWelcomeWidget._originalViewport),this.container&&(this.container.innerHTML=""),document.getElementById("sns-widget-styles")?.remove(),document.querySelectorAll('[id^="sns-widget-style-"], [id^="sns-widget-link-"]').forEach((e=>e.remove())),this.initialized=!1,console.log("Мобильный виджет закрыт"))}}!function(){const t=new r;"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>t.init())):t.init(),window.SNSWelcomeWidget={init:()=>t.init(),destroy:()=>t.destroy(),config:e,widget:t}}()}();
