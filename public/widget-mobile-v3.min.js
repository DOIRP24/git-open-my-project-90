
!function(){"use strict";const e={baseUrl:"https://sns-welcome.vercel.app",containerId:"sns-welcome-widget",background:"#111827",mobileBreakpoint:768,loadingTimeout:2e4,retryAttempts:3,retryDelay:1e3};function t(){const t=`.sns-welcome-widget-container{position:fixed!important;top:0!important;left:0!important;right:0!important;bottom:0!important;width:100vw!important;height:100vh!important;height:100dvh!important;margin:0!important;padding:0!important;background:${e.background}!important;overflow:hidden!important;z-index:2147483647!important;display:flex!important;flex-direction:column!important;box-sizing:border-box!important;-webkit-font-smoothing:antialiased!important;-moz-osx-font-smoothing:grayscale!important}.sns-welcome-widget-content{flex:1!important;width:100%!important;height:100%!important;background:${e.background}!important;display:block!important;position:relative!important;overflow-y:auto!important;overflow-x:hidden!important;-webkit-overflow-scrolling:touch!important;overscroll-behavior:contain!important;box-sizing:border-box!important;padding:0!important;margin:0!important}.sns-welcome-widget-loading{position:absolute!important;top:50%!important;left:50%!important;transform:translate(-50%,-50%)!important;color:#02a374!important;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif!important;font-size:16px!important;z-index:10!important;text-align:center!important;background:${e.background}!important;padding:30px!important;border-radius:12px!important;box-shadow:0 4px 20px rgba(0,0,0,.3)!important}.sns-welcome-widget-spinner{border:3px solid #374151!important;border-top:3px solid #02a374!important;border-radius:50%!important;width:40px!important;height:40px!important;animation:sns-widget-spin 1s linear infinite!important;margin:0 auto 15px!important}@keyframes sns-widget-spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}body.sns-widget-active>*:not(#${e.containerId}){display:none!important;visibility:hidden!important}body.sns-widget-active{margin:0!important;padding:0!important;overflow:hidden!important;height:100vh!important;height:100dvh!important;max-height:100vh!important;max-height:100dvh!important;position:fixed!important;width:100%!important;top:0!important;left:0!important;background:${e.background}!important}html.sns-widget-active{height:100%!important;height:100dvh!important;max-height:none!important;overflow:hidden!important;position:fixed!important;width:100%!important;background:${e.background}!important}.sns-welcome-widget-content *{box-sizing:border-box!important}.sns-welcome-widget-content img{max-width:100%!important;height:auto!important;display:block!important}.sns-welcome-widget-content iframe{width:100%!important;height:100%!important;border:none!important;background:${e.background}!important;display:block!important}@supports (-webkit-touch-callout:none){.sns-welcome-widget-container{height:100vh!important;height:-webkit-fill-available!important;min-height:100vh!important;min-height:-webkit-fill-available!important}.sns-welcome-widget-content{height:100%!important;height:-webkit-fill-available!important;min-height:100vh!important;min-height:-webkit-fill-available!important;-webkit-overflow-scrolling:touch!important;overflow-y:scroll!important}body.sns-widget-active{height:100vh!important;height:-webkit-fill-available!important;min-height:100vh!important;min-height:-webkit-fill-available!important}html.sns-widget-active{height:100vh!important;height:-webkit-fill-available!important;min-height:100vh!important;min-height:-webkit-fill-available!important}}@media screen and (max-width:${e.mobileBreakpoint}px){.sns-welcome-widget-container{position:fixed!important;inset:0!important;width:100vw!important;height:100vh!important;height:100dvh!important;min-height:100vh!important;min-height:100dvh!important}.sns-welcome-widget-content{width:100%!important;height:100%!important;min-height:100vh!important;min-height:100dvh!important}body.sns-widget-active{position:fixed!important;inset:0!important;width:100%!important;height:100%!important;min-height:100vh!important;min-height:100dvh!important}}.sns-welcome-widget-content::-webkit-scrollbar{width:0!important;background:transparent!important}.sns-welcome-widget-content::-webkit-scrollbar-track{background:transparent!important}.sns-welcome-widget-content::-webkit-scrollbar-thumb{background:transparent!important}.sns-welcome-widget-container.loading{opacity:0;transition:opacity .5s ease}.sns-welcome-widget-container.loaded{opacity:1}.sns-welcome-widget-content{font-size:16px!important;line-height:1.5!important}@media screen and (max-width:480px){.sns-welcome-widget-content{font-size:14px!important}}`,n=document.createElement("style");n.textContent=t,n.id="sns-widget-advanced-styles",document.head.appendChild(n)}function n(){return'<div class="sns-welcome-widget-container loading"><div class="sns-welcome-widget-loading"><div class="sns-welcome-widget-spinner"></div><div>Загрузка Welcome курса...</div><div style="font-size: 12px; margin-top: 10px; opacity: 0.7;">Подготавливаем контент для вашего устройства</div></div><div class="sns-welcome-widget-content" id="sns-widget-content"></div></div>'}function i(){let t=document.querySelector('meta[name=viewport]');t||(t=document.createElement("meta"),t.name="viewport",document.head.appendChild(t)),window.SNSWelcomeWidget._originalViewport=t.content,t.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover, interactive-widget=resizes-content, shrink-to-fit=no"}function o(){document.documentElement.classList.add("sns-widget-active"),document.body.classList.add("sns-widget-active");const e={bodyOverflow:document.body.style.overflow,htmlOverflow:document.documentElement.style.overflow,bodyPosition:document.body.style.position,bodyHeight:document.body.style.height,bodyWidth:document.body.style.width,bodyTop:document.body.style.top,bodyLeft:document.body.style.left,bodyMargin:document.body.style.margin,bodyPadding:document.body.style.padding};document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden",document.body.style.position="fixed",document.body.style.width="100%",document.body.style.height="100%",document.body.style.top="0",document.body.style.left="0",document.body.style.margin="0",document.body.style.padding="0",window.SNSWelcomeWidget._originalStyles=e,i()}async function a(t){const n=t.querySelector(".sns-welcome-widget-loading"),i=t.querySelector(".sns-welcome-widget-content"),o=t.querySelector(".sns-welcome-widget-container");console.log("Начинаем улучшенную загрузку контента...");let a=0;async function l(){a++,console.log(`Попытка загрузки ${a}/${e.retryAttempts}`);try{n&&(n.style.display="block");const t=new AbortController,o=setTimeout((()=>t.abort()),15e3),l=await fetch(e.baseUrl,{method:"GET",headers:{Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8","Accept-Language":"ru-RU,ru;q=0.9,en;q=0.8","Accept-Encoding":"gzip, deflate, br","User-Agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 17_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.0 Mobile/15E148 Safari/604.1 SNSWelcomeWidget/3.0","Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache"},mode:"cors",credentials:"omit",signal:t.signal});if(clearTimeout(o),!l.ok)throw new Error(`HTTP ${l.status}: ${l.statusText}`);const r=await l.text();if(console.log("HTML получен, размер:",r.length,"байт"),!r||r.length<100)throw new Error("Получен пустой или слишком короткий ответ");const d=await s(r);if(!d||!d.trim())throw new Error("Обработанный контент пуст");return i.innerHTML=d,console.log("Контент успешно обработан и вставлен"),await c(r),await g(i),p(),!0}catch(t){if(console.error(`Ошибка при попытке ${a}:`,t),a<e.retryAttempts)return console.log(`Ожидание ${e.retryDelay}мс перед следующей попыткой...`),await new Promise((t=>setTimeout(t,e.retryDelay))),l();console.log("Все попытки исчерпаны, переключаемся на iframe..."),u()}}function u(){console.log("Загружаем fallback iframe..."),i.innerHTML=`\n                <iframe \n                    src="${e.baseUrl}"\n                    style="\n                        width: 100% !important; \n                        height: 100% !important; \n                        border: none !important; \n                        background: ${e.background} !important; \n                        display: block !important;\n                        margin: 0 !important;\n                        padding: 0 !important;\n                    "\n                    title="SNS Welcome Course"\n                    allowfullscreen\n                    allow="accelerometer; autoplay; camera; clipboard-read; clipboard-write; encrypted-media; fullscreen; geolocation; gyroscope; magnetometer; microphone; midi; payment; picture-in-picture; publickey-credentials-get; screen-wake-lock; web-share; xr-spatial-tracking"\n                    sandbox="allow-forms allow-modals allow-orientation-lock allow-pointer-lock allow-popups allow-popups-to-escape-sandbox allow-presentation allow-same-origin allow-scripts allow-top-navigation allow-top-navigation-by-user-activation allow-downloads"\n                    loading="eager"\n                    referrerpolicy="strict-origin-when-cross-origin">\n                </iframe>\n            `;const t=i.querySelector("iframe");t&&(t.onload=()=>{console.log("Iframe загружен успешно"),p()},t.onerror=()=>{console.error("Ошибка загрузки iframe"),p()}),setTimeout(p,5e3)}function p(){n&&(n.style.display="none"),o&&(o.classList.remove("loading"),o.classList.add("loaded")),console.log("Загрузка завершена")}return setTimeout(p,e.loadingTimeout),l()}async function s(e){try{const t=new DOMParser,n=t.parseFromString(e,"text/html");if(!n||!n.body)throw new Error("Невозможно разобрать HTML");const i=n.body;["script[src*=\"analytics\"]","script[src*=\"gtag\"]","script[src*=\"facebook\"]","script[src*=\"yandex\"]","noscript",".hidden-mobile","[style*=\"display: none\"]"].forEach((e=>{i.querySelectorAll(e).forEach((e=>e.remove()))})),i.querySelectorAll("img").forEach((e=>{e.style.maxWidth="100%",e.style.height="auto",e.style.display="block",e.loading="lazy",e.alt||(e.alt="")})),i.querySelectorAll("a").forEach((e=>{e.href&&!e.href.startsWith("#")&&(e.target="_blank",e.rel="noopener noreferrer")}));const o=document.createElement("style");return o.textContent="\n                * { \n                    box-sizing: border-box !important; \n                    -webkit-tap-highlight-color: transparent !important;\n                }\n                body { \n                    margin: 0 !important; \n                    padding: 0 !important;\n                    overflow-x: hidden !important;\n                }\n                img { \n                    max-width: 100% !important; \n                    height: auto !important; \n                }\n                .container, .row, .col { \n                    max-width: 100% !important; \n                }\n            ",i.insertBefore(o,i.firstChild),console.log("Контент обработан для мобильных устройств"),i.innerHTML}catch(e){return console.error("Ошибка обработки контента:",e),null}}async function c(e){try{const t=new DOMParser,n=t.parseFromString(e,"text/html");n.querySelectorAll("style").forEach(((e,t)=>{if(e.textContent&&e.textContent.trim()){const n=document.createElement("style");n.textContent=e.textContent,n.id=`sns-widget-style-${t}`,document.head.appendChild(n)}})),n.querySelectorAll('link[rel="stylesheet"]').forEach(((e,t)=>{if(e.href&&!document.querySelector(`link[href="${e.href}"]`)){const n=document.createElement("link");n.rel="stylesheet",n.href=e.href,n.id=`sns-widget-link-${t}`,n.crossOrigin="anonymous",document.head.appendChild(n)}})),console.log("Ресурсы успешно инжектированы")}catch(e){console.warn("Ошибка при инжекции ресурсов:",e)}}async function g(e){const t=e.querySelectorAll("script");console.log("Найдено скриптов для инициализации:",t.length);for(let e=0;e<t.length;e++){const n=t[e];try{n.src?await l(n.src):n.textContent&&n.textContent.trim()&&r(n.textContent),await new Promise((e=>setTimeout(e,50)))}catch(t){console.warn(`Ошибка при инициализации скрипта ${e+1}:`,t)}}}function l(e){return new Promise(((t,n)=>{if(document.querySelector(`script[src="${e}"]`))return void t();const i=document.createElement("script");i.src=e,i.async=!0,i.crossOrigin="anonymous",i.onload=()=>t(),i.onerror=()=>n(new Error(`Не удалось загрузить скрипт: ${e}`)),document.head.appendChild(i)}))}function r(e){try{const t=document.createElement("script");t.textContent=e,document.head.appendChild(t),document.head.removeChild(t)}catch(e){console.warn("Ошибка выполнения inline скрипта:",e)}}class d{constructor(){this.initialized=!1,this.container=null}async init(){if(this.initialized)return void console.log("Виджет уже инициализирован");console.log("Инициализация улучшенного мобильного виджета..."),this.container=document.getElementById(e.containerId),this.container?((()=>{try{t(),o(),this.container.innerHTML=n(),a(this.container),this.setupAdvancedEventListeners(),this.initialized=!0,console.log("Улучшенный мобильный виджет успешно инициализирован")}catch(e){console.error("Ошибка инициализации виджета:",e)}})(),,this.initialized=!0,console.log("Улучшенный мобильный виджет успешно инициализирован")):console.error(`Контейнер с ID "${e.containerId}" не найден`)}setupAdvancedEventListeners(){this.container&&(this.container.addEventListener("click",(e=>{e.stopPropagation()})),this.container.addEventListener("touchstart",(e=>{e.stopPropagation()}),{passive:!0}));const e=()=>{setTimeout((()=>{this.adjustForOrientation()}),200)};window.addEventListener("orientationchange",e),window.addEventListener("resize",e),document.addEventListener("keydown",(e=>{"Escape"===e.key&&e.preventDefault()}))}adjustForOrientation(){if(!this.container)return;const e=this.container.querySelector(".sns-welcome-widget-container"),t=this.container.querySelector(".sns-welcome-widget-content");e&&t&&(e.style.height="100vh",e.style.height="100dvh",t.style.height="100%",t.scrollTop=0,console.log("Виджет адаптирован под новую ориентацию"))}destroy(){this.initialized&&(console.log("Закрытие улучшенного мобильного виджета..."),document.documentElement.classList.remove("sns-widget-active"),document.body.classList.remove("sns-widget-active"),window.SNSWelcomeWidget._originalStyles&&Object.keys(window.SNSWelcomeWidget._originalStyles).forEach((e=>{const t=e.replace(/([A-Z])/g,"-$1").toLowerCase().replace("body-","").replace("html-","");e.startsWith("body")?document.body.style[t]=window.SNSWelcomeWidget._originalStyles[e]||"":e.startsWith("html")&&(document.documentElement.style[t]=window.SNSWelcomeWidget._originalStyles[e]||"")})),window.SNSWelcomeWidget._originalViewport&&(document.querySelector('meta[name="viewport"]').content=window.SNSWelcomeWidget._originalViewport),this.container&&(this.container.innerHTML=""),document.querySelectorAll('#sns-widget-advanced-styles, [id^="sns-widget-style-"], [id^="sns-widget-link-"]').forEach((e=>e.remove())),this.initialized=!1,console.log("Улучшенный мобильный виджет закрыт"))}}!function(){const t=new d,n=()=>{t.init().catch((e=>{console.error("Ошибка автоинициализации:",e)}));"loading"===document.readyState?document.addEventListener("DOMContentLoaded",n):n(),window.SNSWelcomeWidget={init:()=>t.init(),destroy:()=>t.destroy(),config:e,widget:t,version:"3.0"}}()}();
